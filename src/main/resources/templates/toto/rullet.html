<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no"
>
<meta name="description" content="">
<meta name="author" content="">


<title>One Sports</title>

<!-- Custom fonts for this template-->
<link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet"
	type="text/css"
>
<link href="/css/Nunito.css" rel="stylesheet">

<!-- Custom styles for this template-->
<link href="/css/sb-admin-2.min.css" rel="stylesheet">




</head>

<body id="page-top">
	<!-- Page Wrapper -->
	<div id="wrapper">

		<ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion"
			id="accordionSidebar" th:include="/sidebar/sidebar">
		</ul>

		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- Main Content -->
			<div id="content">

				<!-- Topbar -->
				<nav
					class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow"
					th:include="/header/header"
				></nav>
				<!-- End of Topbar -->

				<!-- Begin Page Content -->
				<div class="container-fluid">
					<div class="row">
						<h2 class="text-title">슬롯머신</h2>
						&nbsp;<a class="btn btn-light btn-circle" id="helpButton" character="토순이" href="javascript:;">
							<i class="fas fa-info-circle"></i>
						</a>
					</div>

					<div class="row">
						<div class="col-xl-9 col-lg-9 .col-md-9 .col-sm-9" >
							<div class="card shadow mb-4" style="height:450px">
								<div class="card-header py-3" style="height:100px"></div>
								<!-- 카드 안 토토 -->
								<center>
									<span id="first">
										
									</span>
									<span id="second">
										
									</span>
									<span id="third">
										
									</span><br>
									<input type="button" value="stop" class="rulletButton btn-secondary" onclick="end(0, $(this))" style="width:10%; border-radius:30px; height:40px" disabled>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
									<input type="button" value="stop" class="rulletButton btn-secondary" onclick="end(1, $(this))" style="width:10%; border-radius:30px; height:40px" disabled>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
									<input type="button" value="stop" class="rulletButton btn-secondary" onclick="end(2, $(this))" style="width:10%; border-radius:30px; height:40px" disabled><br>
									<br>
									<input type="text" size="55" id="pay_back" disabled>
								</center>
							</div>
						</div>


						<!-- 배팅리모콘 -->
						<div class="col-xl-3 col-lg-3 .col-md-3 .col-sm-3">
							<div class="card shadow mb-4" style="align: center">
								<div class="card-header py-3">

									<h6 class="m-0 font-weight-bold text-primary text-center"
										style="font-size: 25px">배팅 리모콘</h6>
									<hr>
									<h6 class="m-0 font-weight-bold text-primary text-center">축적된 크레딧</h6>
									<br> <input type="text" class="form-control"
										aria-describedby="basic-addon1" id="accumCredit"
										th:value="${#numbers.formatInteger(accumRulletCredit, 0, 'COMMA')}"
										disabled>
									<hr>
									<h6 class="m-0 font-weight-bold text-primary text-center">보유 크레딧</h6>
									<br> <input type="text" class="form-control"
										aria-describedby="basic-addon1" id="haveCredit"
										th:value="${#numbers.formatInteger(creditInfo.getCreditValue(), 0, 'COMMA')}"
										disabled>
									<hr>

									<h6 class="m-0 font-weight-bold text-primary text-center">배팅금액</h6>
									<br> <input type="text" class="form-control" placeholder="Betting"
										id="credit" aria-describedby="basic-addon1" onKeyPress="InpuOnlyNumber();">
									<hr>
									<input class="btn-secondary" id="betButton" type="button" value="배팅하기"
										onclick="start();" 
										style="width: 100%; margin: 0 auto; height: 45px" ></input><br>
								</div>
							</div>
						</div>


					</div>
					<!-- /.container-fluid -->

				</div>
				<!-- End of Main Content -->

				<!-- Footer -->
				<footer class="sticky-footer bg-white" th:include="/footer/footer">

				</footer>
				<!-- End of Footer -->

			</div>
			<!-- End of Content Wrapper -->

		</div>
		<!-- End of Page Wrapper -->

		<!-- Bootstrap core JavaScript-->
		<script src="/vendor/jquery/jquery.min.js"></script>
		<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

		<!-- Custom scripts for all pages-->
		<script src="/js/sb-admin-2.min.js"></script>

		<!-- common -->
		<script src="/js/common.js"></script>
		<script src="/js/header.js"></script>
</body>

</html>
<script>
var helpCommentList = [
	"4번쨰게임은 슬롯머신이야.<br>여태나온게임처럼 배팅할크레딧을걸고하는게임인데<br>"
+ "우측 배팅리모콘에 너의 현재보유하고있는 크레딧과<br>"
+ "그 크레딧을 사용할 배팅금액을볼수있지",
"슬롯머신의 규칙은 설명할게<br>"
+ "똑같은숫자만나오면 5배<br>"
+ "2의 배수 2-4-6, 4-6-8 (1-3-5)(3-5-7) (1.25배)<br>"
+ "3의 배수 3-6-9 (1.25배)<br>",
  "마지막으로 777이뜨면<br>"
+ "여태까지 사람들이 걸었던 돈을<br>"
+ "전부 획득할수있어"]









	for(i =0;i<=9;i++) {
		$("#first").append('<img src="/img/toto/slotmachine/slot-m'+i+'.png" name="first" style="display:none">');
		$("#second").append('<img src="/img/toto/slotmachine/slot-m'+i+'.png" name="second" style="display:none">');
		$("#third").append('<img src="/img/toto/slotmachine/slot-m'+i+'.png" name="third" style="display:none">');
	}
	
	$("#first img:eq(7)").attr("style","");
	$("#second img:eq(7)").attr("style","");
	$("#third img:eq(7)").attr("style","");
	
	

	$("#credit").focus();
	var GLOBAL_REUSLT_ARR = [-1,-1,-1];
	var GLOBAL_STOP_CHECK_ARR = [0,0,0];
	var	rullet = 0;
	
	function start() {
		GLOBAL_REUSLT_ARR = [-1,-1,-1];
		GLOBAL_STOPCHECK_ARR = [0,0,0];
		rullet = 0;
		
		if($("#credit").val() < 1000 || $("#credit").val() > 100000) {
			alert("1,000 ~ 100,000크레딧만 배팅이 가능합니다.");
			return;
		}
		
		$(".rulletButton").removeAttr("disabled");
		
		$.ajax({
			url : "/toto/rullet/start",
			type : "POST",
			cache : false,
			async: false,
			data : "creditValue=" + $("#credit").val(),
			dataType : "html",
			success : function(data) {
				if(data == -99) {
					alert("배팅할 크레딧이 부족합니다.");
					return;
				} else if(data == 1) {
					// 축적 크레딧 계산
					var  accumCredit = removeComma($("#accumCredit").val());
					
					resultCredit = parseInt(accumCredit) + parseInt(removeComma($("#credit").val()));
					$("#accumCredit").val(numberWithCommas(resultCredit));
					
					$(".rulletButton").attr("disabled", false);
					$("#betButton").attr("disabled", true);
					$("#credit").attr("disabled", true);
					
					var haveCredit = removeComma($("#haveCredit").val());
					
					$("#haveCredit").val(numberWithCommas(haveCredit-$("#credit").val()));
					$("#credit").val(numberWithCommas($("#credit").val()));
					
					asyncExp();
					
					playAlert = setInterval(function() {						
						if(GLOBAL_STOP_CHECK_ARR[0] != -1) {
							$("[name=first]").attr("style","display:none");
							$("[name=first]").eq(rullet).attr("style","");
						}
						
						if(GLOBAL_STOP_CHECK_ARR[1] != -1) {
							$("[name=second]").attr("style","display:none");
							$("[name=second]").eq(rullet).attr("style","");
						}
						
						if(GLOBAL_STOP_CHECK_ARR[2] != -1) {
							$("[name=third]").attr("style","display:none");
							$("[name=third]").eq(rullet).attr("style","");
						}
						
						rullet++;
						
						if(rullet >= 10) {
							rullet = 0;
						}
					}, 10);
				} else {
					alert("에러가 발생하였습니다.\n 새로고침후 다시 시도해주세요.");
				}
			},
			error : function(request, status, error) {
				var msg = "ERROR : " + request.status + "<br>"
				msg += +"내용 : " + request.responseText + "<br>" + error;
				console.log(msg);
			}
		});
	}
	
	function end(idx, obj) {
		GLOBAL_REUSLT_ARR[idx] = rullet-1;	// 
		GLOBAL_STOP_CHECK_ARR[idx] = -1;		// 이미지 멈춤 체크
		obj.attr("disabled", true);
		
		if(GLOBAL_STOP_CHECK_ARR[0] == -1 &&
				GLOBAL_STOP_CHECK_ARR[1] == -1 &&
				GLOBAL_STOP_CHECK_ARR[2] == -1) {
			gameResult();
		}
	}
	
	function gameResult() {
		var arr = GLOBAL_REUSLT_ARR;
		
		$.ajax({
			url : "/toto/rullet/end",
			type : "POST",
			cache : false,
			async: false,
			traditional : true,
			data : {"sResult" : arr},
			dataType : "html",
			success : function(data) {
				if(data >= 0) {
					if(data == 0) {
						$("#pay_back").val("실패");
					} else {
						if(GLOBAL_REUSLT_ARR[0] == 7 &&
								GLOBAL_REUSLT_ARR[1] == 7 &&
								GLOBAL_REUSLT_ARR[2] == 7) {
							$("#pay_back").val("축하합니다! 잭팟이 터졌습니다. " + numberWithCommas(data) + "크레딧을 얻었습니다.");
						} else {
							$("#pay_back").val(numberWithCommas(data) + "크레딧을 얻었습니다.");
						}
						
						var haveCredit = removeComma($("#haveCredit").val());
						$("#haveCredit").val(numberWithCommas(parseInt(haveCredit)+parseInt(data)));
					}
					
					asyncExp();
					
					$("#betButton").val("다시하기");
					$("#betButton").removeAttr("disabled");
					$("#betButton").attr("onclick","location.reload();");
				} else {
					alert("에러가 발생하였습니다.\n 새로고침후 다시 시도해주세요.");
				}
			},
			error : function(request, status, error) {
				var msg = "ERROR : " + request.status + "<br>"
				msg += +"내용 : " + request.responseText + "<br>" + error;
				console.log(msg);
			}
		});
	}
	
</script>